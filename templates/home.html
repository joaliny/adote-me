
     {% extends 'base.html' %}
     {% block title %}P√°gina Inicial - Adote-me{% endblock %}
     {% block content %}

    <!-- Hero Section com Carrossel -->
    <section class="hero">
        <div id="carouselHero" class="carousel slide carousel-hero" data-bs-ride="carousel">
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#carouselHero" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                <button type="button" data-bs-target="#carouselHero" data-bs-slide-to="1" aria-label="Slide 2"></button>
                <button type="button" data-bs-target="#carouselHero" data-bs-slide-to="2" aria-label="Slide 3"></button>
            </div>
            <div class="carousel-inner">
                <div class="carousel-item active"></div>
                <div class="carousel-item"></div>
                <div class="carousel-item"></div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselHero" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Anterior</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselHero" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Pr√≥ximo</span>
            </button>
        </div>
        
        <div class="hero-content">
            <h1>Ol√°, bem vindo(a)!</h1>
            <p>Encontre seu novo melhor amigo e mude uma vida para sempre. Adote um pet e ganhe amor incondicional.</p>
            <a href="/adotar" class="btn-hero">Ver Pets para Ado√ß√£o</a>
        </div>
    </section>

    <!-- Se√ß√£o Grade de Bot√µes - FORA DO CARROSSEL -->
    <section class="grade-botoes-section">
        <div class="grade-botoes">
            <!-- <a href="/adotar" class="botao azul">PETS PARA ADO√á√ÉO</a> -->
            <a href="/divulgar-perdido" class="botao azul-escuro">üêæ DIVULGAR PET PERDIDO</a>
            <button class="botao laranja" onclick="abrirModalDicas()">GERAR DICAS DE CUIDADO COM IA</button>
            <a href="/encontrar" class="botao marrom">ENCONTRAR PET PERFEITO COM IA</a>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features">
        <div class="section-title">
            <h2>Como Funciona</h2>
            <p>Encontrar um novo amigo nunca foi t√£o f√°cil e seguro</p>
        </div>
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">üîç</div>
                <h3>Encontre</h3>
                <p>Busque por pets dispon√≠veis para ado√ß√£o na sua regi√£o com nossos filtros inteligentes.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üíå</div>
                <h3>Conhe√ßa</h3>
                <p>Entre em contato com o respons√°vel pelo pet e marque um encontro para conhec√™-lo.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üè†</div>
                <h3>Adote</h3>
                <p>Complete o processo de ado√ß√£o respons√°vel e leve seu novo amigo para casa.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">ü§ù</div>
                <h3>Acompanhe</h3>
                <p>Receba suporte p√≥s-ado√ß√£o e compartilhe a felicidade do seu novo companheiro.</p>
            </div>
        </div>
    </section>

          <!-- Pets Section
    <section class="pets">
        <div class="section-title">
            <h2>Pets Dispon√≠veis</h2>
            <p>Conhe√ßa alguns dos nossos amigos que est√£o esperando por um lar</p>
            {% if pets and pets|length >= 6 %}
            <div style="margin-top: 15px;">
                <a href="/adotar" class="btn-hero" style="font-size: 0.9rem; padding: 8px 20px;">Ver Todos os Pets</a>
            </div>
            {% endif %}
        </div>
        <div class="pets-grid">
            {% if pets %}
                {% for pet in pets %}
                <div class="pet-card">
                    <div class="pet-image">
                        {% if pet.imagem_url %}
                        <img src="{{ pet.imagem_url }}" alt="Foto do {{ pet.nome }}">
                        {% else %}
                        <div>
                            <span>Sem imagem</span>
                        </div>
                        {% endif %}
                    </div>
                    <div class="pet-info">
                        <h3>{{ pet.nome }}</h3>
                        <div class="pet-meta">
                            <span class="pet-tag">{{ pet.especie }}</span>
                            <span class="pet-tag">{{ pet.idade }} ano{% if pet.idade > 1 %}s{% endif %}</span>
                        </div>
                        <p>{{ pet.descricao[:100] }}{% if pet.descricao|length > 100 %}...{% endif %}</p>
                        <a href="/pet/{{ pet.id }}" class="btn-pet">Conhecer</a>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="no-pets">
                    <h3>Nenhum pet dispon√≠vel no momento</h3>
                    <p>Volte em breve para conhecer nossos amigos!</p>
                    <a href="/cadastrar" class="btn-hero" style="margin-top: 15px;">Cadastrar um Pet</a>
                </div>
            {% endif %}
        </div>
    </section> -->


    <!-- Pets Section -->
    <section class="pets">
        <div class="section-title">
            <h2>Pets Dispon√≠veis</h2>
            <p>Conhe√ßa alguns dos nossos amigos que est√£o esperando por um lar</p>
            {% if pets and pets|length >= 6 %}
            <div style="margin-top: 15px;">
                <a href="/adotar" class="btn-hero" style="font-size: 0.9rem; padding: 8px 20px;">Ver Todos os Pets</a>
            </div>
            {% endif %}
        </div>
        <div class="pets-grid">
            {% if pets %}
            {% for pet in pets %}
            <div class="pet-card">
                <div class="pet-image">
                    {% if pet.imagem_url %}
                    <img src="{{ pet.imagem_url }}" alt="Foto do {{ pet.nome }}">
                    {% else %}
                    <div>
                        <span>Sem imagem</span>
                    </div>
                    {% endif %}
    
                    <!-- Bot√£o de Favorito -->
                    <button class="btn-favorito {% if usuario %}favorito-interativo{% endif %}"
                        data-pet-id="{{ pet.id }}"
                        {% if not usuario %}
                            title="Fa√ßa login para favoritar" disabled
                        {% endif %}>
                        <i class="bi bi-heart"></i>
                    </button>
                </div>
                <div class="pet-info">
                    <h3>{{ pet.nome }}</h3>
                    <div class="pet-meta">
                        <span class="pet-tag">{{ pet.especie }}</span>
                        <span class="pet-tag">{{ pet.idade }} ano{% if pet.idade > 1 %}s{% endif %}</span>
                    </div>
                    <p>{{ pet.descricao[:100] }}{% if pet.descricao|length > 100 %}...{% endif %}</p>
                    <div class="pet-actions">
                        <a href="/pet/{{ pet.id }}" class="btn-pet">Conhecer</a>
                    </div>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <div class="no-pets">
                <h3>Nenhum pet dispon√≠vel no momento</h3>
                <p>Volte em breve para conhecer nossos amigos!</p>
                <a href="/cadastrar" class="btn-hero" style="margin-top: 15px;">Cadastrar um Pet</a>
            </div>
            {% endif %}
        </div>
    </section>


    <!-- Carrossel Pets Perdidos - Vers√£o Clean -->
    {% if pets_perdidos_carrossel %}
    <section class="pets-perdidos-carrossel" style="padding: 50px 0; background: #f8f9fa;">
        <div class="container">
            <div class="text-center mb-5">
                <h2 style="color: #2c3e50; font-weight: 600; margin-bottom: 10px;">Pets Perdidos</h2>
                <p style="color: #6c757d;">Ajude esses amigos a voltarem para casa</p>
                {% if pets_perdidos_carrossel|length >= 4 %}
                <a href="/pets-perdidos" class="btn btn-outline-primary mt-3" style="border-radius: 20px;">
                    Ver Todos
                </a>
                {% endif %}
            </div>
    
            <div class="carrossel-container">
                <div class="carrossel-wrapper">
                    <div class="carrossel-track" id="carrosselPerdidos">
                        {% for pet in pets_perdidos_carrossel %}
                        <div class="carrossel-item">
                            <div class="pet-card-mini">
                                <div class="pet-image-mini">
                                    {% if pet.foto_path %}
                                    <img src="{{ url_for('static', filename='imagens/' + pet.foto_path) }}"
                                        alt="{{ pet.nome }}">
                                    {% else %}
                                    <img src="{{ url_for('static', filename='imagens/pet-default.jpg') }}"
                                        alt="Imagem padr√£o">
                                    {% endif %}
                                    <div class="pet-status-mini">Perdido</div>
                                </div>
                                <div class="pet-info-mini">
                                    <h5>{{ pet.nome }}</h5>
                                    <div class="pet-meta">
                                        <span class="especie">{{ pet.especie }}</span>
                                        {% if pet.raca %}<span class="raca">{{ pet.raca }}</span>{% endif %}
                                    </div>
                                    <p class="local">{{ pet.local_desaparecimento[:25] }}{% if
                                        pet.local_desaparecimento|length > 25 %}...{% endif %}</p>
                                    <div class="pet-actions-mini">
                                        {% if pet.contato_telefone %}
                                        <a href="https://wa.me/55{{ pet.contato_telefone|replace(' ', '')|replace('-', '')|replace('(', '')|replace(')', '') }}?text=Ol√°! Vi que voc√™ est√° procurando o {{ pet.nome }}"
                                            target="_blank" class="btn-whatsapp-mini">
                                            <i class="bi bi-whatsapp"></i>
                                        </a>
                                        {% endif %}
                                        <a href="/pets-perdidos" class="btn-info-mini">
                                            <i class="bi bi-info-circle"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
    
                <!-- Indicadores -->
                <div class="carrossel-indicators">
                    {% for i in range(pets_perdidos_carrossel|length) %}
                    <button class="carrossel-indicator" data-slide="{{ i }}"></button>
                    {% endfor %}
                </div>
            </div>
        </div>
    </section>
    {% endif %}
    
    

   <!-- Modal para Dicas com IA -->
<div id="modalDicas" class="modal">
    <div class="modal-content">
        <span class="close" onclick="fecharModalDicas()">&times;</span>
        <h2>üí° Assistente Virtual de Ado√ß√£o</h2>

        <div class="chat-container">
            <div id="chat-messages" class="chat-messages">
                <div class="message ia-message">
                    <strong>Assistente:</strong> Ol√°! Sou seu assistente virtual especializado em ado√ß√£o e cuidados com
                    pets. Como posso ajudar voc√™ hoje? üêæ
                </div>
            </div>

            <div class="chat-input">
                <input type="text" id="pergunta-ia" placeholder="Digite sua pergunta sobre ado√ß√£o, cuidados, sa√∫de...">
                <button onclick="enviarPerguntaIA()">Enviar</button>
            </div>

            <div class="exemplos-perguntas">
                <p><strong>Exemplos de perguntas:</strong></p>
                <button class="exemplo-btn"
                    onclick="usarExemplo('Como preparar minha casa para um gato novo?')">Preparar casa para
                    gato</button>
                <button class="exemplo-btn" onclick="usarExemplo('Quais vacinas um filhote precisa?')">Vacinas para
                    filhote</button>
                <button class="exemplo-btn"
                    onclick="usarExemplo('Como adestrar um cachorro adulto?')">Adestramento</button>
                <button class="exemplo-btn"
                    onclick="usarExemplo('Qual a alimenta√ß√£o ideal para um pet idoso?')">Alimenta√ß√£o para
                    idosos</button>
            </div>
        </div>
    </div>
</div>



<script>
    // Fun√ß√µes do Modal de Dicas
    function abrirModalDicas() {
        console.log("Abrindo modal de dicas...");
        document.getElementById('modalDicas').style.display = 'block';
        // Limpar mensagens anteriores (opcional)
        // document.getElementById('chat-messages').innerHTML = `
        //     <div class="message ia-message">
        //         <strong>Assistente:</strong> Ol√°! Sou seu assistente virtual especializado em ado√ß√£o e cuidados com pets. Como posso ajudar voc√™ hoje? üêæ
        //     </div>
        // `;
    }

    function fecharModalDicas() {
        document.getElementById('modalDicas').style.display = 'none';
    }

    function usarExemplo(pergunta) {
        document.getElementById('pergunta-ia').value = pergunta;
    }

    async function enviarPerguntaIA() {
        const perguntaInput = document.getElementById('pergunta-ia');
        const pergunta = perguntaInput.value.trim();
        const chatMessages = document.getElementById('chat-messages');

        if (!pergunta) {
            alert('Por favor, digite uma pergunta.');
            return;
        }

        // Adicionar pergunta do usu√°rio ao chat
        chatMessages.innerHTML += `
        <div class="message user-message">
            <strong>Voc√™:</strong> ${pergunta}
        </div>
    `;

        // Limpar input e mostrar carregamento
        perguntaInput.value = '';
        perguntaInput.disabled = true;

        // Adicionar mensagem de carregamento
        const loadingId = 'loading-' + Date.now();
        chatMessages.innerHTML += `
        <div id="${loadingId}" class="message ia-message">
            <strong>Assistente:</strong> Pensando... ‚è≥
        </div>
    `;

        // Rolagem autom√°tica para baixo
        chatMessages.scrollTop = chatMessages.scrollHeight;

        try {
            console.log("Enviando pergunta para IA:", pergunta);

            const response = await fetch('/ia-dicas', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    pergunta: pergunta
                })
            });

            console.log("Resposta recebida:", response);

            if (!response.ok) {
                throw new Error(`Erro HTTP: ${response.status}`);
            }

            const data = await response.json();
            console.log("Dados recebidos:", data);

            // Remover mensagem de carregamento
            document.getElementById(loadingId).remove();

            // Adicionar resposta da IA
            chatMessages.innerHTML += `
            <div class="message ia-message">
                <strong>Assistente:</strong> ${data.resposta}
            </div>
        `;

        } catch (error) {
            console.error('Erro ao enviar pergunta:', error);

            // Remover mensagem de carregamento
            document.getElementById(loadingId).remove();

            // Adicionar mensagem de erro
            chatMessages.innerHTML += `
            <div class="message ia-message" style="border-left-color: #f44336;">
                <strong>Assistente:</strong> Desculpe, ocorreu um erro. Tente novamente em alguns instantes. üòî
            </div>
        `;
        } finally {
            // Reabilitar input
            perguntaInput.disabled = false;
            perguntaInput.focus();

            // Rolagem autom√°tica para baixo
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    }

    // Permitir enviar com Enter
    document.addEventListener('DOMContentLoaded', function () {
        const perguntaInput = document.getElementById('pergunta-ia');
        if (perguntaInput) {
            perguntaInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    enviarPerguntaIA();
                }
            });
        }

        // Fechar modal clicando fora
        window.addEventListener('click', function (event) {
            const modal = document.getElementById('modalDicas');
            if (event.target === modal) {
                fecharModalDicas();
            }
        });
    });



    
// Fun√ß√£o para favoritar/desfavoritar
            async function toggleFavorito(petId, button) {
    if (!button || button.disabled) return;

            try {
        const response = await fetch(`/api/favoritar/${petId}`, {
                method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        });

            const data = await response.json();

            if (data.success) {
            // Atualiza o √≠cone e estilo do bot√£o
            const icon = button.querySelector('i');
            if (data.is_favorito) {
                icon.className = 'bi bi-heart-fill';
            button.classList.add('ativo');
            } else {
                icon.className = 'bi bi-heart';
            button.classList.remove('ativo');
            }

            // Feedback visual
            button.style.transform = 'scale(1.2)';
            setTimeout(() => {
                button.style.transform = 'scale(1)';
            }, 300);

            showAlert(data.message, 'success');
        } else {
                showAlert(data.message, 'error');
        }
    } catch (error) {
                console.error('Erro:', error);
            showAlert('Erro ao processar favorito.', 'error');
    }
}

// Verifica e atualiza o estado dos favoritos ao carregar a p√°gina
document.addEventListener('DOMContentLoaded', function() {
    // Verifica o estado dos favoritos para cada pet
    document.querySelectorAll('.btn-favorito[data-pet-id]').forEach(button => {
        const petId = button.getAttribute('data-pet-id');

        if (!button.disabled) {
            // Adiciona listener de clique para favoritar usando data-pet-id
            button.addEventListener('click', function () {
                toggleFavorito(petId, button);
            });

            fetch(`/api/verificar-favorito/${petId}`)
                .then(response => response.json())
                .then(data => {
                    const icon = button.querySelector('i');
                    if (data.is_favorito) {
                        icon.className = 'bi bi-heart-fill';
                        button.classList.add('ativo');
                    } else {
                        icon.className = 'bi bi-heart';
                        button.classList.remove('ativo');
                    }
                })
                .catch(error => {
                    console.error('Erro ao verificar favorito:', error);
                });
        }
    });
});
            // Fun√ß√£o para mostrar alertas
            function showAlert(message, type) {
    // Remove alertas existentes
    const existingAlerts = document.querySelectorAll('.custom-alert');
    existingAlerts.forEach(alert => alert.remove());

            const alertDiv = document.createElement('div');
            alertDiv.className = `custom-alert alert-${type}`;
            alertDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            z-index: 10000;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: slideIn 0.3s ease;
            `;

            if (type === 'success') {
                alertDiv.style.background = '#28a745';
    } else {
                alertDiv.style.background = '#dc3545';
    }

            alertDiv.textContent = message;
            document.body.appendChild(alertDiv);
    
    setTimeout(() => {
        if (alertDiv.parentNode) {
                alertDiv.style.animation = 'slideOut 0.3s ease';
            setTimeout(() => alertDiv.remove(), 300);
        }
    }, 3000);
}

            // Anima√ß√µes CSS para os alertas
            const style = document.createElement('style');
            style.textContent = `
            @keyframes slideIn {
                from {transform: translateX(100%); opacity: 0; }
            to {transform: translateX(0); opacity: 1; }
    }

            @keyframes slideOut {
                from {transform: translateX(0); opacity: 1; }
            to {transform: translateX(100%); opacity: 0; }
    }
            `;
            document.head.appendChild(style);


            
            // anima√ß√£o carrossel de pets perdidos 
             
             let carrosselIndex = 0;
                let autoPlayInterval;

                // Adicione verifica√ß√£o se os elementos existem
                const carrossel = document.getElementById('carrosselPerdidos');
                const items = document.querySelectorAll('.carrossel-item');
                const indicators = document.querySelectorAll('.carrossel-indicator');

                // Adiciona listener aos indicadores usando data-slide (evita injetar {{ i }} em onclick)
                indicators.forEach((indicator, index) => {
                    const slideIndex = indicator.getAttribute('data-slide');
                    const idx = slideIndex !== null ? parseInt(slideIndex, 10) : index;
                    indicator.addEventListener('click', () => irParaSlide(idx));
                });

                function getItemsPerView() {
                    if (window.innerWidth < 769) return 1;
                    if (window.innerWidth < 1025) return 2;
                    return 3;
                }

                function atualizarCarrossel() {
                    // Verifique se os elementos existem
                    if (!carrossel || items.length === 0) return;

                    const itemsPerView = getItemsPerView();
                    const itemWidth = items[0].offsetWidth + 20;
                    const translateX = -carrosselIndex * itemWidth;
                    carrossel.style.transform = `translateX(${translateX}px)`;

                    // Atualizar indicadores
                    indicators.forEach((indicator, index) => {
                        indicator.classList.toggle('active', index === carrosselIndex);
                    });
                }

                function moverCarrossel(direction) {
                    if (items.length === 0) return;

                    const totalItems = items.length;
                    const itemsPerView = getItemsPerView();

                    carrosselIndex += direction;

                    if (carrosselIndex < 0) {
                        carrosselIndex = totalItems - itemsPerView;
                    } else if (carrosselIndex > totalItems - itemsPerView) {
                        carrosselIndex = 0;
                    }

                    atualizarCarrossel();
                    resetAutoPlay();
                }

                function irParaSlide(index) {
                    carrosselIndex = index;
                    atualizarCarrossel();
                    resetAutoPlay();
                }

                function iniciarAutoPlay() {
                    // Limpe qualquer intervalo existente primeiro
                    if (autoPlayInterval) {
                        clearInterval(autoPlayInterval);
                    }
                    autoPlayInterval = setInterval(() => {
                        moverCarrossel(1);
                    }, 4000);
                }

                function resetAutoPlay() {
                    if (autoPlayInterval) {
                        clearInterval(autoPlayInterval);
                    }
                    iniciarAutoPlay();
                }

                function pausarAutoPlay() {
                    if (autoPlayInterval) {
                        clearInterval(autoPlayInterval);
                    }
                }

                document.addEventListener('DOMContentLoaded', function () {
                    // Espere um pouco para garantir que o DOM est√° totalmente carregado
                    setTimeout(() => {
                        atualizarCarrossel();
                        iniciarAutoPlay();
                    }, 100);

                    // Pausar auto-play quando o mouse estiver sobre o carrossel
                    const carrosselContainer = document.querySelector('.carrossel-container');
                    if (carrosselContainer) {
                        carrosselContainer.addEventListener('mouseenter', pausarAutoPlay);
                        carrosselContainer.addEventListener('mouseleave', iniciarAutoPlay);
                    }

                    window.addEventListener('resize', function () {
                        atualizarCarrossel();
                    });
                });
    
  </script>

    {% endblock %}

