<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Adote-me üêæ{% endblock %}</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

  <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">

  <!-- Estilo espec√≠fico da home (opcional) -->
  {% if pagina == 'home' %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
  {% endif %}
  {% if pagina == 'cadastrar' %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/cadastrar.css') }}">
  {% endif %}
  {% if pagina == 'adotar' %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/adotar.css') }}">
  {% endif %}
  {% if pagina == 'detalhes_pet' %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/detalhes_pet.css') }}">
  {% endif %}
</head>

<body data-mostrar-modal-login="{{ 'true' if mostrar_modal_login else 'false' }}"
  data-mostrar-modal="{{ 'true' if mostrar_modal else 'false' }}">

  <!-- Header e Navega√ß√£o -->
  <header>
    <div class="container-header">
      <a href="/home" class="logo">Adote-<span>aqui üêæ</span></a>
      <nav>
        <ul>
          <li><a href="/home" class="{% if pagina == 'home' %}active{% endif %}">In√≠cio</a></li>
          <li><a href="/sobre" class="{% if pagina == 'sobre' %}active{% endif %}">Sobre</a></li>
          <li><a href="/blog" class="{% if pagina == 'blog' %}active{% endif %}">Blog</a></li>
          <li><a href="/adotar" class="{% if pagina == 'adotar' %}active{% endif %}">Ado√ß√£o</a></li>
          
          {% if usuario and usuario.tipo != 'adotante' %}
          <li><a href="/divulgar-perdido" class="{% if pagina == 'divulgar_perdido' %}active{% endif %}">Divulgar Pet Perdido</a></li>
          {% endif %}
          
          <li><a href="/pets-perdidos" class="{% if pagina == 'pets_perdidos' %}active{% endif %}">Ver Pet Perdido</a></li>

          {% if usuario and usuario.tipo == 'admin' %}
          <li><a href="/cadastrar" class="{% if pagina == 'cadastrar' %}active{% endif %}">Cadastrar Pet</a></li>
          {% endif %}
        </ul>
      </nav>

      <!-- BOT√ïES DE AUTENTICA√á√ÉO - APENAS UMA DIV -->
      <div class="auth-buttons">
        {% if usuario and usuario.id %}
        <div class="dropdown">
          <button class="btn btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
            Ol√°, {{ usuario.nome.split(' ')[0] }}
            {% if usuario.tipo == 'admin' %} üßë‚Äçüíª
            {% else %} üòä
            {% endif %}
          </button>
          <ul class="dropdown-menu">
            <!-- PARA ADMIN -->
            {% if usuario.tipo == 'admin' %}
            <li><a class="dropdown-item" href="/admin">
                <i class="bi bi-speedometer2"></i> Dashboard Admin
              </a></li>
            <li><a class="dropdown-item" href="/admin/usuarios">
                <i class="bi bi-people"></i> Gerenciar Usu√°rios
              </a></li>

            <!-- PARA USU√ÅRIO COMUM (ADOTANTE) -->
            {% else %}
            <li><a class="dropdown-item" href="/minha-conta">
                <i class="bi bi-person"></i> Minha Conta
              </a></li>
            <li><a class="dropdown-item" href="/meus-favoritos">
                <i class="bi bi-heart"></i> Meus Favoritos
              </a></li>
            <li><a class="dropdown-item" href="/minhas-adocoes">
                <i class="bi bi-house-check"></i> Minhas Ado√ß√µes
              </a></li>
            {% endif %}

            <!-- OP√á√ïES COMUNS A TODOS -->
            <li>
              <hr class="dropdown-divider">
            </li>
            <li><a class="dropdown-item text-danger" href="/logout">
                <i class="bi bi-box-arrow-right"></i> Sair
              </a></li>
          </ul>
        </div>
        {% else %}
        <a href="/login" class="btn-login">Entrar</a>
        <a href="/cadastro" class="btn-register">Cadastrar</a>
        {% endif %}
      </div>
    </div>
  </header>

  <!-- Conte√∫do da p√°gina -->
  <main>
    {% block content %}{% endblock %}
  </main>

  <!-- Footer global -->
  <footer>
    <div class="footer-content">
      <div class="footer-column">
        <a href="/home" class="logo">Adote-<span style="filter: brightness(0) invert(1);">aquiüêæ</span></a>
        <p>Conectando pets a lares amorosos desde 2025. Nossa miss√£o √© reduzir o n√∫mero de animais abandonados atrav√©s
          da ado√ß√£o respons√°vel.</p>
      </div>

      <div class="footer-column">
        <h3>Links R√°pidos</h3>
        <ul>
          <li><a href="/home">P√°gina Inicial</a></li>
          <li><a href="/sobre">Sobre n√≥s</a></li>
          <li><a href="/blog">Blog</a></li>
          <li><a href="/adotar">Pets para ado√ß√£o</a></li>
        </ul>
      </div>

      <div class="footer-column">
        <h3>Contato</h3>
        <ul>
          <li>Email: contato@adote-me.com</li>
          <li>Telefone: (92) 1234-5678</li>
          <li>Endere√ßo: Manaus, AM</li>
        </ul>
      </div>
    </div>

    <div class="copyright">
      <p>&copy; 2025 Adote-me. Todos os direitos reservados.</p>
    </div>
  </footer>




  <script>
    // Fun√ß√£o global para favoritar pets
    function toggleFavorito(petId, button) {
      if (!button) return;

      fetch(`/api/favoritar/${petId}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        }
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Atualiza o √≠cone e estilo do bot√£o
            const icon = button.querySelector('i');
            if (data.is_favorito) {
              icon.className = 'bi bi-heart-fill';
              button.classList.add('btn-favorito-ativo');
            } else {
              icon.className = 'bi bi-heart';
              button.classList.remove('btn-favorito-ativo');
            }

            // Mostra mensagem de feedback
            showGlobalAlert(data.message, 'success');
          } else {
            showGlobalAlert(data.message, 'error');
          }
        })
        .catch(error => {
          console.error('Erro:', error);
          showGlobalAlert('Erro ao processar favorito.', 'error');
        });
    }

    // Fun√ß√£o para mostrar alertas globais
    function showGlobalAlert(message, type) {
      const alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
      const alertDiv = document.createElement('div');
      alertDiv.className = `alert ${alertClass} alert-dismissible fade show position-fixed`;
      alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
      alertDiv.innerHTML = `
          ${message}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `;

      document.body.appendChild(alertDiv);

      setTimeout(() => {
        if (alertDiv.parentNode) {
          alertDiv.remove();
        }
      }, 3000);
    }

    // Verifica e atualiza o estado dos bot√µes de favorito na p√°gina
    document.addEventListener('DOMContentLoaded', function () {
      // Verifica o estado dos favoritos para cada pet na p√°gina
      document.querySelectorAll('[data-pet-id]').forEach(button => {
        const petId = button.getAttribute('data-pet-id');

        fetch(`/api/verificar-favorito/${petId}`)
          .then(response => response.json())
          .then(data => {
            const icon = button.querySelector('i');
            if (data.is_favorito) {
              icon.className = 'bi bi-heart-fill';
              button.classList.add('btn-favorito-ativo');
            } else {
              icon.className = 'bi bi-heart';
              button.classList.remove('btn-favorito-ativo');
            }
          })
          .catch(error => {
            console.error('Erro ao verificar favorito:', error);
          });
      });
    });
  </script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>