<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login - Adote-me</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      min-height: 100vh;
      background-color: #0b2342;
      font-family: 'Poppins', sans-serif;
      display: flex;
      flex-direction: column;
    }

    .container-flex {
      flex: 1;
      display: flex;
      flex-wrap: wrap;
    }

    .left-side {
      background-color: #00487B;
      width: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .left-side img {
      max-width: 100%;
      height: auto;
      max-height: 90vh;
    }

    .right-side {
      background-color: #fff7ef;
      width: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .login-box {
      width: 80%;
      max-width: 380px;
    }

    .login-box h2 {
      text-align: center;
      font-weight: 700;
      color: #00487B;
      margin-bottom: 30px;
    }

    .form-label {
      font-weight: 500;
      color: #0b2342;
    }

    .input-group-text {
      background-color: transparent;
      border-right: none;
      color: #0b2342;
    }

    .form-control {
      border-left: none;
      border-radius: 0 10px 10px 0;
      box-shadow: none;
    }

    .input-group {
      border: 1px solid #0b2342;
      border-radius: 10px;
      overflow: hidden;
    }

    .btn-primary {
      background-color: #00487B;
      border: none;
      border-radius: 25px;
      padding: 10px;
      font-weight: 600;
    }

    .btn-primary:hover {
      background-color: #102f5d;
    }

    .btn-secondary {
      background-color: #00487B;
      border: none;
      border-radius: 25px;
      padding: 10px;
      font-weight: 600;
    }

    .btn-secondary:hover {
      background-color: #102f5d;
    }

    .extra-options {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.9rem;
      margin-bottom: 15px;
    }

    .extra-options label,
    .extra-options a {
      color: #0b2342;
    }

    .extra-options a {
      text-decoration: none;
      font-weight: 500;
    }

    .extra-options a:hover {
      text-decoration: underline;
    }

    .d-grid button,
    .d-grid a {
      font-size: 1rem;
    }

    /* Responsividade */
    @media (max-width: 991.98px) {
      .left-side,
      .right-side {
        width: 100%;
      }
      .container-flex {
        flex-direction: column;
      }
      .left-side {
        padding: 2rem 0;
      }
      .right-side {
        padding: 2rem 1rem;
      }
      .left-side img {
        max-width: 70%;
      }
    }

    @media (max-width: 575.98px) {
      .left-side img {
        max-width: 90%;
      }
      .login-box {
        width: 90%;
      }
    }
  </style>
</head>

<body>
  <div class="container-flex">
    <div class="left-side">
      <img src="{{ url_for('static', filename='imagens/logo-adote-me.png') }}" alt="Logo Adote-me" />
    </div>

    <div class="right-side">
      <div class="login-box">
        <h2>Entrar</h2>
        <form method="POST" action="{{ url_for('login_usuario') }}">
          <div class="mb-3">
            <label for="email" class="form-label">Login</label>
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-person"></i></span>
              <input type="email" class="form-control" id="email" name="email" placeholder="Endereço de e-mail"
                required />
            </div>
          </div>

          <div class="mb-3">
            <label for="senha" class="form-label">Senha</label>
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-lock"></i></span>
              <input type="password" class="form-control" id="senha" name="senha" placeholder="Senha" required />
            </div>
          </div>

          <div class="extra-options">
            <div>
              <input type="checkbox" id="lembrar" />
              <label for="lembrar">Lembrar de mim</label>
            </div>
            <a href="#" data-bs-toggle="modal" data-bs-target="#modalEsqueciSenha">Esqueci minha senha</a>
          </div>

          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary">ENTRAR</button>
            <a href="/cadastro" class="btn btn-secondary text-center">CRIAR CONTA</a>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal Esqueci Senha -->
  <div class="modal fade" id="modalEsqueciSenha" tabindex="-1" aria-labelledby="modalEsqueciSenhaLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-body p-4">
          <div class="text-center mb-4">
            <h4 class="modal-title fw-bold text-dark">Recuperar Senha</h4>
            <p class="text-muted mt-2">Digite seu e-mail para receber um link de recuperação.</p>
          </div>


          <div id="mensagemSucesso" class="alert alert-success alert-dismissible fade show d-none mb-3">
            <i class="bi bi-check-circle me-2"></i>
            <span id="textoSucesso">Enviamos um e-mail com instruções para redefinir sua senha.</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>


          <div id="mensagemErro" class="alert alert-danger alert-dismissible fade show d-none mb-3">
            <i class="bi bi-exclamation-triangle me-2"></i>
            <span id="textoErro">Erro ao processar solicitação.</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>

          <form id="formEsqueciSenha" method="POST">
            <div class="mb-4">
              <label for="emailRecuperacao" class="form-label fw-semibold text-dark">Seu e-mail:</label>
              <div class="input-group">
                <span class="input-group-text bg-light border-end-0">
                  <i class="bi bi-envelope text-muted"></i>
                </span>
                <input type="email" class="form-control border-start-0" id="emailRecuperacao" name="email"
                  placeholder="seu@email.com" required />
              </div>
            </div>

            <div class="border-top my-4"></div>

            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary btn-lg fw-semibold py-2">
                <i class="bi bi-send me-2"></i>Enviar Link de Recuperação
              </button>

              <button type="button" class="btn btn-outline-secondary py-2" data-bs-dismiss="modal">
                <i class="bi bi-arrow-left me-2"></i>Voltar para o Login
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.getElementById('formEsqueciSenha').addEventListener('submit', function (e) {
      e.preventDefault();

      const email = document.getElementById('emailRecuperacao').value.trim();
      const mensagemSucesso = document.getElementById('mensagemSucesso');
      const mensagemErro = document.getElementById('mensagemErro');
      const textoErro = document.getElementById('textoErro');
      const textoSucesso = document.getElementById('textoSucesso');
      const form = document.getElementById('formEsqueciSenha');

      if (!email || !email.includes('@') || !email.includes('.')) {
        mostrarErro('Por favor, digite um e-mail válido.');
        return;
      }

      const btnEnviar = this.querySelector('button[type="submit"]');
      const textoOriginal = btnEnviar.innerHTML;
      btnEnviar.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Enviando...';
      btnEnviar.disabled = true;

      mensagemSucesso.classList.add('d-none');
      mensagemErro.classList.add('d-none');

      fetch('{{ url_for("esqueci_senha") }}', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
          'X-Requested-With': 'XMLHttpRequest'
        },
        body: new URLSearchParams({
          'email': email
        })
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            textoSucesso.textContent = data.message;
            mostrarSucesso();
          } else {
            mostrarErro(data.message);
          }
        })
        .catch(error => {
          console.error('Erro:', error);
          mostrarErro('Erro de conexão. Tente novamente.');
        })
        .finally(() => {
          btnEnviar.innerHTML = textoOriginal;
          btnEnviar.disabled = false;
        });
    });

    function mostrarSucesso() {
      const mensagemSucesso = document.getElementById('mensagemSucesso');
      const mensagemErro = document.getElementById('mensagemErro');
      const form = document.getElementById('formEsqueciSenha');

      mensagemErro.classList.add('d-none');
      mensagemSucesso.classList.remove('d-none');
      form.classList.add('d-none');

      setTimeout(() => {
        const modal = bootstrap.Modal.getInstance(document.getElementById('modalEsqueciSenha'));
        modal.hide();

        setTimeout(() => {
          form.classList.remove('d-none');
          document.getElementById('emailRecuperacao').value = '';
        }, 500);
      }, 6000);
    }

    function mostrarErro(mensagem) {
      const mensagemErro = document.getElementById('mensagemErro');
      const textoErro = document.getElementById('textoErro');
      textoErro.textContent = mensagem;
      mensagemErro.classList.remove('d-none');
      mensagemErro.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    document.getElementById('modalEsqueciSenha').addEventListener('hidden.bs.modal', function () {
      const mensagemSucesso = document.getElementById('mensagemSucesso');
      const mensagemErro = document.getElementById('mensagemErro');
      const form = document.getElementById('formEsqueciSenha');
      mensagemSucesso.classList.add('d-none');
      mensagemErro.classList.add('d-none');
      form.classList.remove('d-none');
      document.getElementById('emailRecuperacao').value = '';
    });

    document.getElementById('modalEsqueciSenha').addEventListener('shown.bs.modal', function () {
      document.getElementById('emailRecuperacao').focus();
    });
  </script>
</body>

</html>
